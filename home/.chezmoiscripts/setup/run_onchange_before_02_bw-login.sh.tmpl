#!/usr/bin/env bash

{{- if .personal }}

check_install() {
  local cmd="$1"
  local pkg="$2"
  
  if ! command -v "$cmd" &>/dev/null; then
    echo "installing $pkg"
    sudo pacman -S --needed --noconfirm "$pkg"
  fi

}

set_bw() {
  if ! bw login --check &> /dev/null; then
    echo "logging into bitwarden"
    bw config server "{{ .bw_url }}"
    bw login {{ .bw_login }}
  fi
  export BW_SESSION="$(bw unlock --raw)"
}

check_install bw bitwarden-cli

set_bw

{{ end -}}
